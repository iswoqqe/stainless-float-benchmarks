# Stainless Float Benchmarks

- SMT-LIB files are generated using `[STAINLESS] --debug=smt --solvers=[SOLVER] --solver:cvc5=--arrays-exp --vc-cache=false --timeout=1000 [SOURCE FILE...]`
	- `SOLVER` is `smt-z3` or `smt-cvc5`
	- `STAINLESS` is the executable `[STAINLESS_REPO_ROOT]/frontends/dotty/target/universal/stage/bin/stainless-dotty`
	- A timeout of 1000s is used to attempt to ensure that we have sufficient unrollings to run the solvers for 900s
	- `z3` sometimes yields the result `UNKNOWN` for some verification conditions

- The `run_solver.sh` script can run a solver on a subset of the generated SMT-LIB files.  For example, all files genreated for the `cvc5` solver
	- Usage example: `bash run_solver.sh 'cvc5 -q --produce-models --incremental --lang smt2.6 --arrays-exp' cvc5 log_cvc5.log`

- The log can be converted to csv using the awk script `to_csv.awk`
	- Usage example: `awk -f to_csv.awk log_cvc5.txt`

## About `z3` and `UNKNOWN`

- The `z3` solver returns `UNKOWN` for some verification conditions when running Stainless.
- This behaviour seems highly non-deterministic.  There are some verification conditions for which `z3` sometimes yields unkown and sometimes does sometimes not.
- It seems like `UNKNOWN` is mainly returned for difficult verification conditions.
- When running `z3` on the SMT-LIB files generated by Stainless, this does not seem to happen.

- A consequence of `z3` returning `UNKNOWN` is that the generated SMT-LIB file for that verification condition is (likely) missing some function definition unrollings and `check-sat` calls.
- If `z3` times out when running on the generated SMT-LIB file, the missing unrollings are not an issue.
- We can manually check the result when running `z3` on the SMT-LIB file for every affected verification condition.
- All such files can be found by comparing the number of `check-sat` commands in the `z3` and `cvc5` versions of the SMT-LIB files.
- This can be done using the command: `grep check-sat smt-sessions --recursive --count | sort -t- -k3,3 -k4,4n | awk -v FS=":" '{ split($1,b,"-"); key = b[3] b[4]; if (key in a) { if (a[key] != $2) print key ": " $2 " != " a[key] } else { a[key] = $2} }'`.
